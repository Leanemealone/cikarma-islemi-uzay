<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Uzayda Matematik</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: 'Luckiest Guy', Arial; touch-action: none; }
        canvas { display: block; background: url('https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/arka%20plan%20(2).png'); background-size: cover; }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// SES DOSYALARI
const arkaPlanMuzigi = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
arkaPlanMuzigi.loop = true;
arkaPlanMuzigi.volume = 0.2;

const crashSesi = new Audio('https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/main/crash.mp3');
const alkisSesi = new Audio('https://raw.githubusercontent.com/Leanemealone/Eldeli-Toplama-Oyunu/main/clap.mp3');

function ekranBoyutlandir() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
ekranBoyutlandir();
window.addEventListener("resize", ekranBoyutlandir);

let skor = 0; 
let meteorHizi = 1.3; 
let soru = { s1: 0, s2: 0, sonuc: 0 }; 
let meteorlar = [];
let gemi = { x: canvas.width / 2, y: canvas.height - 200 };

// SÜRE SİSTEMİ
let kalanSure = 120;
let oyunBitti = false;

let zamanlayici = setInterval(() => {
    if (!oyunBitti) {
        kalanSure--;
        if (kalanSure <= 0) {
            kalanSure = 0;
            oyunBitti = true;
            clearInterval(zamanlayici);
        }
    }
}, 1000);

let mesaj = "";
let mesajRengi = "";
let mesajSayac = 0;

function ekraniSalla() {
    if (navigator.vibrate) navigator.vibrate(300);
    crashSesi.play(); 
    let siddet = 15; let sayac = 0;
    document.body.style.backgroundColor = "#550000";
    let sarsintiInterval = setInterval(() => {
        let xSalla = (Math.random()*siddet*2)-siddet; let ySalla = (Math.random()*siddet*2)-siddet;
        canvas.style.transform = `translate(${xSalla}px, ${ySalla}px)`;
        if (++sayac > 15) { clearInterval(sarsintiInterval); canvas.style.transform = `translate(0,0)`; document.body.style.backgroundColor = "#000"; }
    }, 30);
}

const gemiResmi = new Image(); gemiResmi.src = 'https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/uzay%20araci.png';
const meteorResmi = new Image(); meteorResmi.src = 'https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/goktasi.png';

// --- GELİŞTİRİLMİŞ SORU ÜRETME (ÇAKIŞMA ÖNLEYİCİ) ---
function soruUret() {
    soru.s1 = Math.floor(Math.random() * 30) + 20;
    soru.s2 = Math.floor(Math.random() * 15) + 1;
    soru.sonuc = soru.s1 - soru.s2;
    
    let tipler = [
        { deger: soru.sonuc, tip: "dogru" },
        { deger: soru.sonuc + 5, tip: "yanlis" },
        { deger: soru.sonuc - 3, tip: "yanlis" },
        { deger: soru.sonuc + 8, tip: "yanlis" }
    ];

    // Önce tipleri karıştır
    for (let i = tipler.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [tipler[i], tipler[j]] = [tipler[j], tipler[i]];
    }

    meteorlar = [];
    tipler.forEach((mVeri, index) => {
        let yeniX;
        let cakismaVar = true;
        let denemeSayisi = 0;

        // Diğer meteorlarla çakışmayacak bir X bulana kadar dene
        while (cakismaVar && denemeSayisi < 20) {
            yeniX = Math.random() * (canvas.width - 160);
            cakismaVar = meteorlar.some(m => Math.abs(m.x - yeniX) < 180); // 180px güvenli mesafe
            denemeSayisi++;
        }

        meteorlar.push({
            ...mVeri,
            x: yeniX,
            y: -200 - (index * 450) // Dikey mesafeyi de koruyoruz
        });
    });
}

window.addEventListener("mousemove", (e) => { 
    if (oyunBitti) return;
    arkaPlanMuzigi.play();
    gemi.x = e.clientX-75; gemi.y = e.clientY-75; 
});
window.addEventListener("touchstart", (e) => { 
    if (oyunBitti) return;
    arkaPlanMuzigi.play();
    gemi.x = e.touches[0].clientX-75; gemi.y = e.touches[0].clientY-75; e.preventDefault(); 
}, { passive: false });
window.addEventListener("touchmove", (e) => { 
    if (oyunBitti) return;
    gemi.x = e.touches[0].clientX-75; gemi.y = e.touches[0].clientY-75; e.preventDefault(); 
}, { passive: false });

function guncelle() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    if (oyunBitti) {
        ctx.fillStyle = "rgba(0,0,0,0.8)";
        ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.fillStyle = "white";
        ctx.textAlign = "center";
        ctx.font = "60px 'Luckiest Guy'";
        ctx.fillText("SÜRE BİTTİ!", canvas.width / 2, canvas.height / 2 - 40);
        ctx.font = "40px 'Luckiest Guy'";
        ctx.fillText("TOPLAM PUAN: " + skor, canvas.width / 2, canvas.height / 2 + 40);
        ctx.font = "24px Arial";
        ctx.fillText("Yeniden başlamak için sayfayı yenile", canvas.width / 2, canvas.height / 2 + 100);
        return;
    }

    // SORU ÇİZİMİ
    ctx.fillStyle = "#FFD700";
    ctx.strokeStyle = "black";
    ctx.lineWidth = 4;
    ctx.font = "bold 60px 'Luckiest Guy'";
    ctx.textAlign = "right";
    let hizalamaX = canvas.width / 2 + 40;
    
    ctx.strokeText(soru.s1, hizalamaX, 75);
    ctx.fillText(soru.s1, hizalamaX, 75);
    
    ctx.strokeText(soru.s2, hizalamaX, 135);
    ctx.fillText(soru.s2, hizalamaX, 135);
    
    ctx.textAlign = "left";
    ctx.strokeText("-", hizalamaX - 100, 135);
    ctx.fillText("-", hizalamaX - 100, 135);
    
    ctx.beginPath(); ctx.strokeStyle = "white"; ctx.lineWidth = 6; ctx.lineCap = "round";
    ctx.moveTo(hizalamaX-110, 155); ctx.lineTo(hizalamaX+10, 155); ctx.stroke();

    ctx.textAlign = "left";
    ctx.fillStyle = "white"; 
    ctx.font = "24px 'Luckiest Guy'";
    ctx.fillText(`Puan: ${skor}`, 20, 40);
    
    ctx.textAlign = "right";
    ctx.fillStyle = kalanSure < 10 ? "#FF0000" : "white";
    ctx.fillText(`Süre: ${kalanSure}`, canvas.width - 20, 40);

    if (mesajSayac > 0) {
        ctx.fillStyle = mesajRengi;
        ctx.strokeStyle = "black";
        ctx.lineWidth = 3;
        ctx.font = "bold 50px 'Luckiest Guy'";
        ctx.textAlign = "center";
        ctx.strokeText(mesaj, canvas.width / 2, canvas.height / 2);
        ctx.fillText(mesaj, canvas.width / 2, canvas.height / 2);
        mesajSayac--;
    }

    if (gemi.y < 220) gemi.y = 220;
    if (gemi.y > canvas.height-150) gemi.y = canvas.height-150;
    if (gemi.x < 0) gemi.x = 0;
    if (gemi.x > canvas.width-150) gemi.x = canvas.width-150;

    ctx.drawImage(gemiResmi, gemi.x, gemi.y, 150, 150);

    meteorlar.forEach((m) => {
        m.y += meteorHizi;
        ctx.drawImage(meteorResmi, m.x, m.y, 160, 160);
        ctx.fillStyle = "white"; ctx.font = "bold 35px Arial"; ctx.textAlign = "center";
        ctx.fillText(m.deger, m.x + 80, m.y + 95);

        let t = 45; 
        if (gemi.x + t < m.x + 160 - t && 
            gemi.x + 150 - t > m.x + t && 
            gemi.y + t < m.y + 160 - t && 
            gemi.y + 150 - t > m.y + t) {
            
            if (m.tip === "dogru") {
                alkisSesi.play();
                skor += 10;
                kalanSure += 2; 
                meteorHizi += 0.05;
                mesaj = "Harika! +2 sn";
                mesajRengi = "#00FF00";
                mesajSayac = 60;
                soruUret();
            } else {
                ekraniSalla();
                mesaj = "Dikkat! -10";
                mesajRengi = "#FF0000";
                mesajSayac = 60;
                skor -= 10;
                if (skor < 0) skor = 0;
                gemi.x = canvas.width / 2 - 75;
                gemi.y = canvas.height - 200;
                meteorHizi = 1.3;
                soruUret();
            }
        }

        if (m.y > canvas.height) { 
            m.y = -200; 
            // Burada da yeni X belirlerken çakışma kontrolü yapıyoruz
            let yeniX;
            let cakismaVar = true;
            while(cakismaVar) {
                yeniX = Math.random() * (canvas.width - 160);
                cakismaVar = meteorlar.some(diger => diger !== m && Math.abs(diger.x - yeniX) < 180);
            }
            m.x = yeniX;
        }
    });
    requestAnimationFrame(guncelle);
}
soruUret(); guncelle();
</script>
</body>
</html>
