<!DOCTYPE html>
<html lang="tr">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <title>Uzayda Matematik: Seviye MacerasÄ±</title>
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  body { margin: 0; overflow: hidden; background: #000; color: white; font-family: 'Luckiest Guy', Arial; touch-action: none; }
Â  Â  Â  Â  canvas { display: block; background-color: #000; }
Â  Â  Â  Â  #entryPanel {
Â  Â  Â  Â  Â  Â  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
Â  Â  Â  Â  Â  Â  background: rgba(10, 10, 50, 0.95); padding: 30px; border-radius: 25px;
Â  Â  Â  Â  Â  Â  text-align: center; border: 5px solid #FFD700; z-index: 1000; width: 320px;
Â  Â  Â  Â  }
Â  Â  Â  Â  #entryPanel h2 { color: #FFD700; margin-bottom: 20px; font-size: 28px; }
Â  Â  Â  Â  select, input, button { padding: 12px; margin: 10px 0; border-radius: 12px; font-family: 'Luckiest Guy'; font-size: 18px; width: 100%; border: none; box-sizing: border-box; }
Â  Â  Â  Â  select, input { background: #eee; color: #333; }
Â  Â  Â  Â  button { background: #00FF00; color: #000; cursor: pointer; transition: 0.3s; }
Â  Â  Â  Â  button:hover { background: #00cc00; }
Â  Â  Â  Â  #leaderboard { margin-top: 20px; max-height: 180px; overflow-y: auto; text-align: left; font-size: 14px; background: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 10px; }
Â  Â  Â  Â  .score-row { display: flex; justify-content: space-between; padding: 3px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
Â  Â  </style>
</head>
<body>

<div id="entryPanel">
Â  Â  <h2>KOZMÄ°K GÄ°RÄ°Åž</h2>
Â  Â  <select id="studentSelect">
Â  Â  Â  Â  <option value="">Ä°SÄ°MLER YÃœKLENÄ°YOR...</option>
Â  Â  </select>
Â  Â  <input type="password" id="passInput" placeholder="ÅžÄ°FRE">
Â  Â  <button id="startBtn">MACERAYA BAÅžLA</button>
Â  Â Â 
Â  Â  <div id="leaderboard">
Â  Â  Â  Â  <div style="text-align: center; color: #FFD700; margin-bottom: 5px;">TOP 10 LÄ°DERLER</div>
Â  Â  Â  Â  <div id="scoreList">YÃ¼kleniyor...</div>
Â  Â  </div>
</div>

<canvas id="gameCanvas"></canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, collection, query, orderBy, limit, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

const firebaseConfig = {
Â  Â  apiKey: "AIzaSyBLNmwvxDkVk2qpwwLt-CoXFtb45N3_Mvg",
Â  Â  authDomain: "uzay-cikarma-oyunu.firebaseapp.com",
Â  Â  projectId: "uzay-cikarma-oyunu",
Â  Â  storageBucket: "uzay-cikarma-oyunu.firebasestorage.app",
Â  Â  messagingSenderId: "11975442094",
Â  Â  appId: "1:11975442094:web:56b7006bb8bfc0e670f73f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let currentUser = "";
let girisYapildi = false;

// Sesler ve GÃ¶rseller
const arkaPlanMuzigi = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');Â 
arkaPlanMuzigi.loop = true; arkaPlanMuzigi.volume = 0.2;
const crashSesi = new Audio('https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/main/crash.mp3');
const alkisSesi = new Audio('https://raw.githubusercontent.com/Leanemealone/Eldeli-Toplama-Oyunu/main/clap.mp3');
const bgImg = new Image(); const shipImg = new Image();
const meteorImg = new Image(); meteorImg.src = 'https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/goktasi.png';

let skor = 0; let seviye = 1; let meteorHizi = 1.3; let kalanSure = 120;
let can = 3; let oyunBitti = false; let bitisNedeni = "";
let soru = { s1: 0, s2: 0, sonuc: 0, bonus: false };
let meteorlar = []; let mesaj = ""; let mesajRengi = ""; let mesajSayac = 0;
let seviyeMesajSayac = 120; let seviyeBonusHakki = true;
let gemi = { x: 0, y: 0 };

// --- FIREBASE: Ã–ÄžRENCÄ° LÄ°STESÄ°NÄ° Ã‡EK ---
async function ogrenciListesiniYukle() {
Â  Â  const select = document.getElementById("studentSelect");

Â  Â  try {
Â  Â  Â  Â  const snap = await getDocs(collection(db, "ogrenciler"));

Â  Â  Â  Â  select.innerHTML = '<option value="">Ä°SMÄ°NÄ° SEÃ‡...</option>';

Â  Â  Â  Â  snap.forEach((docSnap) => {
Â  Â  Â  Â  Â  Â  const data = docSnap.data();

Â  Â  Â  Â  Â  Â  let opt = document.createElement("option");
Â  Â  Â  Â  Â  Â  opt.value = docSnap.id;Â  Â // giriÅŸte doc id kullanÄ±lacak
Â  Â  Â  Â  Â  Â  opt.textContent = data.ad; // ekranda gÃ¶rÃ¼nen ad
Â  Â  Â  Â  Â  Â  select.appendChild(opt);
Â  Â  Â  Â  });

Â  Â  Â  Â  console.log("Ã–ÄŸrenciler yÃ¼klendi:", snap.size);

Â  Â  } catch (err) {
Â  Â  Â  Â  console.error("Ã–ÄŸrenci listesi alÄ±namadÄ±:", err);
Â  Â  Â  Â  select.innerHTML = '<option value="">YÃœKLENEMEDÄ°</option>';
Â  Â  }
}
ogrenciListesiniYukle();

// --- GÄ°RÄ°Åž KONTROLÃœ ---
document.getElementById("startBtn").onclick = async () => {
Â  Â  const selected = document.getElementById("studentSelect").value;
Â  Â  const pass = document.getElementById("passInput").value;
Â  Â  if (!selected) return alert("Ä°sminizi seÃ§in!");

Â  Â  const userRef = doc(db, "ogrenciler", selected);
Â  Â  const userSnap = await getDoc(userRef);

Â  Â  if (userSnap.exists() && String(userSnap.data().sifre) === pass) {
Â  Â  currentUser = userSnap.data().ad; // ðŸ”¥ GERÃ‡EK Ä°SÄ°M
Â  Â  girisYapildi = true;
Â  Â  document.getElementById("entryPanel").style.display = "none";
Â  Â  oyunuSifirla();
Â  Â  guncelle();
} else {
Â  Â  alert("HatalÄ± ÅŸifre!");
}
};

async function saveScoreToFirebase(puan) {
Â  Â  if (!currentUser) return;
Â  Â  const userRef = doc(db, "uzay_skorlar", currentUser);
Â  Â  const snap = await getDoc(userRef);
Â  Â  if (!snap.exists() || snap.data().skor < puan) {
Â  Â  Â  Â  await setDoc(userRef, { isim: currentUser, skor: puan, tarih: Date.now() });
Â  Â  }
}

function listenLeaderboard() {
Â  Â  const q = query(collection(db, "uzay_skorlar"), orderBy("skor", "desc"), limit(10));
Â  Â  onSnapshot(q, (snapshot) => {
Â  Â  Â  Â  let html = "";
Â  Â  Â  Â  snapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  html += `<div class="score-row"><span>${doc.data().isim}</span><span>${doc.data().skor} Puan</span></div>`;
Â  Â  Â  Â  });
Â  Â  Â  Â  document.getElementById("scoreList").innerHTML = html || "Skor yok";
Â  Â  });
}
listenLeaderboard();

function ekranBoyutlandir() {Â 
Â  Â  canvas.width = window.innerWidth;Â 
Â  Â  canvas.height = window.innerHeight;Â 
Â  Â  gemi.x = canvas.width / 2 - 40;Â 
Â  Â  gemi.y = canvas.height - 150;
}
ekranBoyutlandir();
window.addEventListener("resize", ekranBoyutlandir);

function seviyeAyarla() {
Â  Â  const arkaPlanlar = ['https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/arka%20plan%20(2).png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/background2.png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/background3.png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/background4.png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/background5.png'];
Â  Â  const gemiResimleri = ['https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/uzay%20araci.png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/uzaygemisi2.png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/uzaygemisi3.png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/uzaygemisi4.png','https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/refs/heads/main/uzaygemisi5.png'];
Â  Â Â 
Â  Â  bgImg.src = arkaPlanlar[(seviye - 1) % arkaPlanlar.length];
Â  Â  shipImg.src = gemiResimleri[(seviye - 1) % gemiResimleri.length];
Â  Â Â 
Â  Â  kalanSure = 120; can = 3; meteorHizi = 1.3 + (seviye * 0.2);
Â  Â  seviyeMesajSayac = 120; seviyeBonusHakki = true;
Â  Â  soruUret();
}

function oyunuSifirla() {
Â  Â  skor = 0; seviye = 1; can = 3; kalanSure = 120;
Â  Â  oyunBitti = false; seviyeAyarla();
}

function soruUret() {
Â  Â  let s1, s2;
Â  Â  let bonusMu = (seviyeBonusHakki && Math.random() < 0.25);
Â  Â  if (bonusMu) seviyeBonusHakki = false;
Â  Â Â 
Â  Â  if (seviye === 1) {
Â  Â  Â  Â  do { s1 = Math.floor(Math.random() * 20) + 10; s2 = Math.floor(Math.random() * 9) + 1; } while (s1 % 10 < s2 % 10);
Â  Â  } else {
Â  Â  Â  Â  s1 = Math.floor(Math.random() * 40) + 20; s2 = Math.floor(Math.random() * 19) + 1;
Â  Â  }
Â  Â Â 
Â  Â  soru = { s1: s1, s2: s2, sonuc: s1 - s2, bonus: bonusMu };
Â  Â  let secenekler = [
Â  Â  Â  Â  { deger: soru.sonuc, tip: "dogru" },Â 
Â  Â  Â  Â  { deger: soru.sonuc + 5, tip: "yanlis" },Â 
Â  Â  Â  Â  { deger: soru.sonuc - 3, tip: "yanlis" },Â 
Â  Â  Â  Â  { deger: soru.sonuc + 2, tip: "yanlis" }
Â  Â  ];
Â  Â  secenekler.sort(() => Math.random() - 0.5);
Â  Â  meteorlar = secenekler.map((m, index) => ({ ...m, x: Math.random() * (canvas.width - 100), y: -250 - (index * 450) }));
}

setInterval(() => {
Â  Â  if (girisYapildi && !oyunBitti && seviyeMesajSayac <= 0) {
Â  Â  Â  Â  kalanSure--;
Â  Â  Â  Â  if (kalanSure <= 0) { kalanSure = 0; oyunBitti = true; bitisNedeni = "SÃœRE BÄ°TTÄ°!"; saveScoreToFirebase(skor); }
Â  Â  }
}, 1000);

function ekraniSalla() {
Â  Â  if (navigator.vibrate) navigator.vibrate(200);
Â  Â  crashSesi.play();
Â  Â  let siddet = 15; let sayac = 0;
Â  Â  let sarsinti = setInterval(() => {
Â  Â  Â  Â  canvas.style.transform = `translate(${(Math.random()*siddet*2)-siddet}px, ${(Math.random()*siddet*2)-siddet}px)`;
Â  Â  Â  Â  if (++sayac > 15) { clearInterval(sarsinti); canvas.style.transform = `translate(0,0)`; }
Â  Â  }, 30);
}

const kontrol = (ex, ey) => {Â 
Â  Â  if (oyunBitti || !girisYapildi) return;
Â  Â  if (seviyeMesajSayac <= 0) {Â 
Â  Â  Â  Â  arkaPlanMuzigi.play();
Â  Â  Â  Â  gemi.x = ex - 40; gemi.y = ey - 40;
Â  Â  }Â 
};

window.addEventListener("mousemove", (e) => kontrol(e.clientX, e.clientY));
window.addEventListener("touchstart", (e) => {Â 
Â  Â  if (oyunBitti) {Â 
Â  Â  Â  Â  document.getElementById("entryPanel").style.display = "block";Â 
Â  Â  Â  Â  girisYapildi = false;Â 
Â  Â  }
Â  Â  kontrol(e.touches[0].clientX, e.touches[0].clientY);Â 
Â  Â  e.preventDefault();
}, { passive: false });

window.addEventListener("touchmove", (e) => {Â 
Â  Â  if(!oyunBitti) {Â 
Â  Â  Â  Â  gemi.x = e.touches[0].clientX - 40;Â 
Â  Â  Â  Â  gemi.y = e.touches[0].clientY - 40;Â 
Â  Â  }Â 
Â  Â  e.preventDefault();Â 
}, { passive: false });

function guncelle() {
Â  Â  if (!girisYapildi) return;
Â  Â  ctx.clearRect(0, 0, canvas.width, canvas.height);
Â  Â  ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);

Â  Â  if (oyunBitti) {
Â  Â  Â  Â  ctx.fillStyle = "rgba(0,0,0,0.85)"; ctx.fillRect(0,0,canvas.width, canvas.height);
Â  Â  Â  Â  ctx.fillStyle = "white"; ctx.textAlign = "center"; ctx.font = "60px 'Luckiest Guy'";
Â  Â  Â  Â  ctx.fillText(bitisNedeni, canvas.width / 2, canvas.height / 2 - 80);
Â  Â  Â  Â  ctx.font = "40px 'Luckiest Guy'"; ctx.fillText("SKORUN: " + skor, canvas.width / 2, canvas.height / 2 - 20);
Â  Â  Â  Â  ctx.font = "22px 'Luckiest Guy'"; ctx.fillText("YENÄ° GÄ°RÄ°Åž Ä°Ã‡Ä°N EKRANA DOKUN", canvas.width / 2, canvas.height / 2 + 50);
Â  Â  Â  Â  return requestAnimationFrame(guncelle);
Â  Â  }

Â  Â  if (seviyeMesajSayac > 0) {
Â  Â  Â  Â  ctx.fillStyle = "rgba(0,0,0,0.6)"; ctx.fillRect(0, canvas.height/2-100, canvas.width, 200);
Â  Â  Â  Â  ctx.fillStyle = "#FFD700"; ctx.textAlign = "center"; ctx.font = "80px 'Luckiest Guy'";
Â  Â  Â  Â  ctx.fillText("SEVÄ°YE " + seviye, canvas.width / 2, canvas.height / 2 + 30);
Â  Â  Â  Â  seviyeMesajSayac--; return requestAnimationFrame(guncelle);
Â  Â  }

Â  Â  // UI Ã‡izimi
Â  Â  ctx.textAlign = "left"; ctx.fillStyle = "white"; ctx.font = "24px 'Luckiest Guy'";
Â  Â  ctx.fillText(`${currentUser} | Puan: ${skor}`, 20, 40);
Â  Â  ctx.fillStyle = "#FFD700"; ctx.fillText(`Seviye: ${seviye}`, 20, 75);
Â  Â  ctx.textAlign = "right"; ctx.fillStyle = kalanSure < 10 ? "red" : "white";
Â  Â  ctx.fillText(`SÃ¼re: ${kalanSure}`, canvas.width - 20, 40);
Â  Â  for(let i=0; i<3; i++){ ctx.fillStyle = i < can ? "red" : "#555"; ctx.fillText("â¤", canvas.width - 20 - (i*35), 75); }

Â  Â  // Soru Ã‡izimi
Â  Â  ctx.fillStyle = soru.bonus ? "#FF00FF" : "#FFD700"; ctx.strokeStyle = "black"; ctx.lineWidth = 4;
Â  Â  ctx.font = "bold 60px 'Luckiest Guy'"; ctx.textAlign = "right";
Â  Â  let hX = canvas.width / 2 + 40;
Â  Â  ctx.strokeText(soru.s1, hX, 75); ctx.fillText(soru.s1, hX, 75);
Â  Â  ctx.strokeText(soru.s2, hX, 135); ctx.fillText(soru.s2, hX, 135);
Â  Â  ctx.textAlign = "left"; ctx.strokeText("-", hX - 100, 135); ctx.fillText("-", hX - 100, 135);
Â  Â  ctx.beginPath(); ctx.strokeStyle = "white"; ctx.lineWidth = 6; ctx.moveTo(hX-110, 155); ctx.lineTo(hX+10, 155); ctx.stroke();

Â  Â  // Gemi SÄ±nÄ±rlarÄ± ve Ã‡izimi
Â  Â  gemi.y = Math.max(220, Math.min(gemi.y, canvas.height - 80));
Â  Â  gemi.x = Math.max(0, Math.min(gemi.x, canvas.width - 80));
Â  Â  ctx.drawImage(shipImg, gemi.x, gemi.y, 80, 80);

Â  Â  // Meteorlar
Â  Â  meteorlar.forEach((m) => {
Â  Â  Â  Â  m.y += meteorHizi;
Â  Â  Â  Â  ctx.save(); ctx.shadowBlur = 15; ctx.shadowColor = soru.bonus ? "purple" : "orange";
Â  Â  Â  Â  ctx.drawImage(meteorImg, m.x, m.y, 100, 160); ctx.restore();
Â  Â  Â  Â  ctx.fillStyle = "white"; ctx.font = "bold 30px Arial"; ctx.textAlign = "center";
Â  Â  Â  Â  ctx.fillText(m.deger, m.x + 50, m.y + 130);

Â  Â  Â  Â  // Ã‡arpÄ±ÅŸma KontrolÃ¼
Â  Â  Â  Â  if (gemi.x + 10 < m.x + 90 && gemi.x + 70 > m.x + 10 && gemi.y + 10 < m.y + 150 && gemi.y + 70 > m.y + 80) {
Â  Â  Â  Â  Â  Â  if (m.tip === "dogru") {
Â  Â  Â  Â  Â  Â  Â  Â  alkisSesi.currentTime = 0; alkisSesi.play();
Â  Â  Â  Â  Â  Â  Â  Â  skor += soru.bonus ? 20 : 10; kalanSure += 2;
Â  Â  Â  Â  Â  Â  Â  Â  mesaj = soru.bonus ? "BONUS! +20 Puan" : "Harika! +2 Sn";
Â  Â  Â  Â  Â  Â  Â  Â  mesajRengi = "#00FF00"; mesajSayac = 60;
Â  Â  Â  Â  Â  Â  Â  Â  if (skor >= seviye * 80) { seviye++; seviyeAyarla(); } else { soruUret(); }
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  ekraniSalla(); can--;
Â  Â  Â  Â  Â  Â  Â  Â  mesaj = "Dikkat! Can Gitti"; mesajRengi = "red"; mesajSayac = 60;
Â  Â  Â  Â  Â  Â  Â  Â  if (can <= 0) { oyunBitti = true; bitisNedeni = "CANINIZ BÄ°TTÄ°!"; saveScoreToFirebase(skor); }
Â  Â  Â  Â  Â  Â  Â  Â  skor = Math.max(0, skor - 10); gemi.x = canvas.width / 2 - 40; gemi.y = canvas.height - 150; soruUret();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (m.y > canvas.height) {Â 
Â  Â  Â  Â  Â  Â  let enYukaridakiY = Math.min(...meteorlar.map(met => met.y));
Â  Â  Â  Â  Â  Â  m.y = enYukaridakiY - 450; m.x = Math.random() * (canvas.width - 100);
Â  Â  Â  Â  }
Â  Â  });

Â  Â  if (mesajSayac > 0) {
Â  Â  Â  Â  ctx.fillStyle = mesajRengi; ctx.font = "bold 40px 'Luckiest Guy'"; ctx.textAlign = "center";
Â  Â  Â  Â  ctx.fillText(mesaj, canvas.width / 2, canvas.height / 2 + 100); mesajSayac--;
Â  Â  }
Â  Â  requestAnimationFrame(guncelle);
}
</script>
</body>
</html>
