<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Uzayda Matematik</title>
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: 'Luckiest Guy', Arial; touch-action: none; }
        canvas { display: block; background: url('https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/arka%20plan%20(2).png'); background-size: cover; }
    </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

// SES DOSYALARI
const arkaPlanMuzigi = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3');
arkaPlanMuzigi.loop = true;
arkaPlanMuzigi.volume = 0.2;

const crashSesi = new Audio('https://raw.githubusercontent.com/Leanemealone/cikarma-islemi-uzay/main/crash.mp3');

function ekranBoyutlandir() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
ekranBoyutlandir();
window.addEventListener("resize", ekranBoyutlandir);

let skor = 0; 
let meteorHizi = 1.5; 
let soru = { s1: 0, s2: 0, sonuc: 0 }; 
let meteorlar = [];
let gemi = { x: canvas.width / 2, y: canvas.height - 200 };

let mesaj = "";
let mesajRengi = "";
let mesajSayac = 0;

function ekraniSalla() {
    if (navigator.vibrate) navigator.vibrate(300);
    crashSesi.play(); 
    let siddet = 15; let sayac = 0;
    document.body.style.backgroundColor = "#550000";
    let sarsintiInterval = setInterval(() => {
        let xSalla = (Math.random()*siddet*2)-siddet; let ySalla = (Math.random()*siddet*2)-siddet;
        canvas.style.transform = `translate(${xSalla}px, ${ySalla}px)`;
        if (++sayac > 15) { clearInterval(sarsintiInterval); canvas.style.transform = `translate(0,0)`; document.body.style.backgroundColor = "#000"; }
    }, 30);
}

const gemiResmi = new Image(); gemiResmi.src = 'https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/uzay%20araci.png';
const meteorResmi = new Image(); meteorResmi.src = 'https://raw.githubusercontent.com/Leanemealone/assets-images/refs/heads/main/goktasi.png';

function soruUret() {
    soru.s1 = Math.floor(Math.random() * 30) + 20;
    soru.s2 = Math.floor(Math.random() * 15) + 1;
    soru.sonuc = soru.s1 - soru.s2;
    
    let yeniMeteorlar = [
        { deger: soru.sonuc, tip: "dogru" },
        { deger: soru.sonuc + 5, tip: "yanlis" },
        { deger: soru.sonuc - 3, tip: "yanlis" },
        { deger: soru.sonuc + 8, tip: "yanlis" }
    ];

    for (let i = yeniMeteorlar.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [yeniMeteorlar[i], yeniMeteorlar[j]] = [yeniMeteorlar[j], yeniMeteorlar[i]];
    }

    meteorlar = yeniMeteorlar.map((m, index) => {
        return { ...m, x: Math.random() * (canvas.width - 160), y: -200 - (index * 450) };
    });
}

// KONTROLLER
window.addEventListener("mousemove", (e) => { 
    arkaPlanMuzigi.play();
    gemi.x = e.clientX-75; gemi.y = e.clientY-75; 
});
window.addEventListener("touchstart", (e) => { 
    arkaPlanMuzigi.play();
    gemi.x = e.touches[0].clientX-75; gemi.y = e.touches[0].clientY-75; e.preventDefault(); 
}, { passive: false });
window.addEventListener("touchmove", (e) => { 
    gemi.x = e.touches[0].clientX-75; gemi.y = e.touches[0].clientY-75; e.preventDefault(); 
}, { passive: false });

function guncelle() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // --- EĞLENCELİ ALT ALTA SORU ÇİZİMİ ---
    ctx.fillStyle = "#FFD700"; // Altın Sarısı
    ctx.strokeStyle = "black";
    ctx.lineWidth = 4;
    ctx.font = "bold 60px 'Luckiest Guy'";
    ctx.textAlign = "right";
    let hizalamaX = canvas.width / 2 + 40;
    
    ctx.strokeText(soru.s1, hizalamaX, 75);
    ctx.fillText(soru.s1, hizalamaX, 75);
    
    ctx.strokeText(soru.s2, hizalamaX, 135);
    ctx.fillText(soru.s2, hizalamaX, 135);
    
    ctx.textAlign = "left";
    ctx.strokeText("-", hizalamaX - 100, 135);
    ctx.fillText("-", hizalamaX - 100, 135);
    
    ctx.beginPath(); ctx.strokeStyle = "white"; ctx.lineWidth = 6; ctx.lineCap = "round";
    ctx.moveTo(hizalamaX-110, 155); ctx.lineTo(hizalamaX+10, 155); ctx.stroke();

    // SKOR
    ctx.textAlign = "left";
    ctx.fillStyle = "white"; ctx.font = "30px 'Luckiest Guy'";
    ctx.fillText(`Puan: ${skor}`, 30, 50);

    // GERİ BİLDİRİM MESAJI
    if (mesajSayac > 0) {
        ctx.fillStyle = mesajRengi;
        ctx.font = "bold 70px 'Luckiest Guy'";
        ctx.textAlign = "center";
        ctx.strokeText(mesaj, canvas.width / 2, canvas.height / 2);
        ctx.fillText(mesaj, canvas.width / 2, canvas.height / 2);
        mesajSayac--;
    }

    // SINIRLAR
    if (gemi.y < 220) gemi.y = 220;
    if (gemi.y > canvas.height-150) gemi.y = canvas.height-150;
    if (gemi.x < 0) gemi.x = 0;
    if (gemi.x > canvas.width-150) gemi.x = canvas.width-150;

    ctx.drawImage(gemiResmi, gemi.x, gemi.y, 150, 150);

    meteorlar.forEach((m) => {
        m.y += meteorHizi;
        ctx.drawImage(meteorResmi, m.x, m.y, 160, 160);
        ctx.fillStyle = "white"; ctx.font = "bold 35px Arial"; ctx.textAlign = "center";
        // Sayıları meteorun içine yazarken standart font daha okunaklıdır
        ctx.fillText(m.deger, m.x + 80, m.y + 95);

        // --- HASSAS ÇARPIŞMA KONTROLÜ ---
        let t = 45; 
        if (gemi.x + t < m.x + 160 - t && 
            gemi.x + 150 - t > m.x + t && 
            gemi.y + t < m.y + 160 - t && 
            gemi.y + 150 - t > m.y + t) {
            
            if (m.tip === "dogru") {
                skor += 10;
                meteorHizi += 0.1;
                mesaj = "Aferin! +10";
                mesajRengi = "#00FF00";
                mesajSayac = 60;
                soruUret();
            } else {
                ekraniSalla();
                mesaj = "Yanlış! -10";
                mesajRengi = "#FF0000";
                mesajSayac = 60;
                skor -= 10;
                if (skor < 0) skor = 0;
                gemi.x = canvas.width / 2 - 75;
                gemi.y = canvas.height - 200;
                meteorHizi = 1.5;
                soruUret();
            }
        }

        if (m.y > canvas.height) { 
            m.y = -200; 
            m.x = Math.random()*(canvas.width-160); 
        }
    });
    requestAnimationFrame(guncelle);
}
soruUret(); guncelle();
</script>
</body>
</html>
